<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Mekina Auction{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav>
        <a href="{{ url_for('main.home') }}" class="nav-brand">Mekina</a>
        <div class="nav-menu" id="nav-menu">
            <ul>
                {% if current_user.is_authenticated and current_user.is_admin %}
                    <li><a href="{{ url_for('admin.dashboard') }}" class="{{ 'active' if request.endpoint == 'admin.dashboard' }}">Dashboard</a></li>
                    <li><a href="{{ url_for('admin.rental_management') }}" class="{{ 'active' if request.endpoint == 'admin.rental_management' }}">Manage Rentals</a></li>
                    <li><a href="{{ url_for('admin.user_management') }}" class="{{ 'active' if request.endpoint == 'admin.user_management' }}">Users</a></li>
                    <li><a href="{{ url_for('auctions.list_auctions') }}" class="{{ 'active' if request.endpoint == 'auctions.list_auctions' }}">Manage Listings</a></li>
                {% elif current_user.is_authenticated and current_user.is_rental_company %}
                    <li><a href="{{ url_for('rentals.dashboard') }}" class="{{ 'active' if request.endpoint == 'rentals.dashboard' }}">Rental Dashboard</a></li>
                {% elif current_user.is_authenticated %}
                    <li><a href="{{ url_for('main.all_listings') }}" class="{{ 'active' if request.endpoint == 'main.all_listings' }}">All Listings</a></li>
                    <li><a href="{{ url_for('auctions.list_auctions') }}" class="{{ 'active' if request.endpoint == 'auctions.list_auctions' }}">All Auctions</a></li>
                    <li><a href="{{ url_for('rentals.list_rentals') }}" class="{{ 'active' if request.endpoint == 'rentals.list_rentals' }}">Rentals</a></li>
                    {% if current_user.is_dealer %}
                        <li><a href="{{ url_for('dealer.dashboard') }}" class="{{ 'active' if request.endpoint == 'dealer.dashboard' }}">Dealer Dashboard</a></li>
                    {% endif %}
                    {% if not current_user.is_dealer %}
                    <li><a href="{{ url_for('request.my_requests') }}" class="{{ 'active' if request.endpoint == 'request.my_requests' }}">My Requests</a></li>
                    {% endif %}
                    {% if not current_user.is_dealer %}
                        <li><a href="{{ url_for('seller.dashboard') }}" class="{{ 'active' if request.endpoint == 'seller.dashboard' }}">Seller Dashboard</a></li>
                    {% endif %}
                {% else %}
                    <li><a href="{{ url_for('main.all_listings') }}" class="{{ 'active' if request.endpoint == 'main.all_listings' }}">All Listings</a></li>
                    <li><a href="{{ url_for('auctions.list_auctions') }}" class="{{ 'active' if request.endpoint == 'auctions.list_auctions' }}">All Auctions</a></li>
                    <li><a href="{{ url_for('rentals.list_rentals') }}" class="{{ 'active' if request.endpoint == 'rentals.list_rentals' }}">Rentals</a></li>
                {% endif %}
            </ul>
            {# This nav-right is for desktop and the mobile dropdown menu #}
            <div class="nav-right"> 
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('main.notifications') }}" class="desktop-notification-link">
                        Notifications 
                        {% if unread_notifications > 0 %}<span class="notification-badge">{{ unread_notifications }}</span>{% endif %}
                    </a>
                    <span class="desktop-username">Hi, {{ current_user.username }}!</span>
                    <a href="{{ url_for('auth.logout') }}" class="nav-button">Logout</a>
                {% else %}
                    <a href="{{ url_for('auth.login') }}" class="nav-button">Login</a>
                    <a href="{{ url_for('auth.register') }}" class="nav-button">Register</a>
                {% endif %}
            </div>
        </div>
        {# Mobile-only notification bell icon and hamburger toggle, grouped together #}
        <div class="mobile-nav-icons">
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('main.notifications') }}" class="mobile-notification-bell-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bell"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                    {% if unread_notifications > 0 %}<span class="notification-badge">{{ unread_notifications }}</span>{% endif %}
                </a>
            {% endif %}
            <button class="mobile-nav-toggle" id="mobile-nav-toggle" aria-label="Toggle navigation">
                <span class="hamburger-icon"></span>
            </button>
        </div>
    </nav>
    <main class="container">
        {% with messages = get_flashed_messages() %}
        {% if messages %}
            <ul class=flashes>
            {% for message in messages %}
                <li>{{ message }}</li>
            {% endfor %}
            </ul>
        {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </main>

    {% block after_content %}{% endblock %}

    <footer class="site-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-brand">
                    <h4>Mekina Auction</h4>
                    <p>
                        The premier automotive marketplace for modern vehicles in Ethiopia.
                    </p>
                </div>
                <div class="footer-links">
                    <h4>Buying</h4>
                    <ul>
                        <li><a href="{{ url_for('main.all_listings') }}">All Listings</a></li>
                        <li><a href="{{ url_for('main.how_it_works') }}">How It Works</a></li>
                        <li><a href="#">FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>Selling</h4>
                    <ul>
                        <li><a href="{{ url_for('seller.submit_car') }}">List Your Car</a></li>
                        <li><a href="#">Seller Guide</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>Support</h4>
                    <ul>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">Terms & Conditions</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; {{ now.year }} Mekina Auction. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Fullscreen Image Viewer Modal -->
    <div id="image-viewer-modal" class="image-viewer-modal">
        <span class="close-image-viewer">&times;</span>
        <button class="image-viewer-nav prev" id="viewer-prev-btn">&lt;</button>
        <img class="image-viewer-content" id="fullscreen-image">
        <button class="image-viewer-nav next" id="viewer-next-btn">&gt;</button>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const mobileNavToggle = document.getElementById('mobile-nav-toggle');
    const navMenu = document.getElementById('nav-menu');

    if (mobileNavToggle && navMenu) {
        mobileNavToggle.addEventListener('click', function() {
            navMenu.classList.toggle('active');
            this.classList.toggle('active');
        });
    }
});
</script>

</body>
</html>
