{% extends "base.html" %}

{% block title %}Auction Management{% endblock %}

{% block content %}
    <h1>Auction Management</h1>

    <table border="1" style="width:100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th>Car</th>
                <th>Owner</th>
                <th>Current Price</th>
                <th>End Time</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for auction in auctions.items %}
            <tr>
                <td>{{ auction.car.year }} {{ auction.car.make }} {{ auction.car.model }}</td>
                <td>{{ auction.car.owner.username }}</td>
                <td>{{ '{:,.2f}'.format(auction.current_price) }} ETB</td>
                <td>{{ auction.end_time.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>
                    {% if not auction.car.is_approved %}
                        <span style="color: orange; font-weight: bold;">Pending Approval</span>
                    {% elif auction.end_time > now %}
                        <span style="color: green;">Active</span>
                    {% else %}
                        <span style="color: red;">Expired</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('admin.edit_auction', auction_id=auction.id) }}" style="text-decoration: none; background-color: #007bff; color: white; padding: 5px 10px; border-radius: 3px; margin-right: 5px;">Edit</a>
                    <form action="{{ url_for('admin.delete_auction', auction_id=auction.id) }}" method="post" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this auction and car? This cannot be undone.');">
                        <button type="submit" style="background-color: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="pagination" style="margin-top: 20px;">
        {% if auctions.has_prev %}<a href="{{ url_for('auctions.list_auctions', page=auctions.prev_num) }}">&laquo; Previous</a>{% endif %}
        <span>Page {{ auctions.page }} of {{ auctions.pages }}</span>
        {% if auctions.has_next %}<a href="{{ url_for('auctions.list_auctions', page=auctions.next_num) }}">Next &raquo;</a>{% endif %}
    </div>
{% endblock %}