{% extends "base.html" %}

{% block title %}Auction Management{% endblock %}

{% block content %}
    <h1>Auction Management</h1>

    <table>
        <thead>
            <tr>
                <th>Car</th>
                <th>Owner</th>
                <th>Current Price</th>
                <th>End Time</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for auction in auctions.items %}
            <tr>
                <td>{{ auction.car.year }} {{ auction.car.make }} {{ auction.car.model }}</td>
                <td>{{ auction.car.owner.username }}</td>
                <td>{{ '{:,.2f}'.format(auction.current_price) }} ETB</td>
                <td>{{ auction.end_time.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>
                    {% if not auction.car.is_approved %}
                        <span style="color: hsl(var(--warning)); font-weight: bold;">Pending Approval</span>
                    {% elif auction.end_time > now %}
                        <span style="color: hsl(var(--success));">Active</span>
                    {% else %}
                        <span style="color: hsl(var(--destructive));">Expired</span>
                    {% endif %}
                </td>
                <td class="button-group">
                    <a href="{{ url_for('admin.edit_listing', car_id=auction.car.id) }}" class="btn edit">Edit</a>
                    <form action="{{ url_for('admin.delete_listing', auction_id=auction.id) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this listing? This cannot be undone.');">
                        <button type="submit" class="btn delete">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="pagination">
        {% if auctions.has_prev %}<a href="{{ url_for('auctions.list_auctions', page=auctions.prev_num) }}">&laquo; Previous</a>{% endif %}
        <span>Page {{ auctions.page }} of {{ auctions.pages }}</span>
        {% if auctions.has_next %}<a href="{{ url_for('auctions.list_auctions', page=auctions.next_num) }}">Next &raquo;</a>{% endif %}
    </div>
{% endblock %}