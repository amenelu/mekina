{% extends "base.html" %}

{% block title %}{{ dealer.username }}'s Profile{% endblock %}

{% block main_content %}
<div class="container">
    <div class="dealer-profile-hero">
        <div class="dealer-info">
            <div class="dealer-logo-placeholder">
                {{ dealer.username[0]|upper }}
            </div>
            <div class="dealer-details">
                <div class="dealer-name-verified">
                    <h1>{{ dealer.username }}</h1>
                    {% if dealer.is_verified %}
                        <span class="verified-badge">Verified</span>
                    {% endif %}
                </div>
                {% if dealer.tagline %}
                    <p class="dealer-tagline">{{ dealer.tagline }}</p>
                {% endif %}
                <div class="dealer-rating-summary">
                    {% if avg_rating > 0 %}
                        {% for i in range(5) %}
                            <span class="star {% if i < avg_rating|round(0, 'floor') %}filled{% endif %}">★</span>
                        {% endfor %}
                        <span class="rating-text">{{ '%.1f'|format(avg_rating) }} ({{ ratings|length }} reviews)</span>
                    {% else %}
                        <span class="text-muted">No reviews yet</span>
                    {% endif %}
                </div>
                <p>Email: {{ dealer.email }}</p>
                {% if can_view_phone %}
                    <p>Phone: {{ dealer.phone_number }}</p>
                {% else %}
                    <p>Phone: <span class="text-muted">Contact dealer via message</span></p>
                {% endif %}
            </div>
        </div>
        {# Add any other dealer profile actions or info here #}
    </div>

    <div class="dashboard-section">
        <h2>Active Listings</h2>
        {% if listings %}
            <div class="auction-grid"> {# Assuming you have an auction-grid style for cards #}
                {% for car in listings %}
                    {# Render car card here, similar to how you do in all_listings.html #}
                    {# Example: #}
                    <a href="{{ url_for('main.car_detail', car_id=car.id) }}" class="auction-card-link">
                        <div class="auction-card">
                            <div class="card-image-container">
                                <img src="{{ car.primary_image_url or url_for('static', filename='img/default_car.png') }}" alt="{{ car.make }} {{ car.model }}">
                                {% if car.is_featured %}<span class="featured-tag">Featured</span>{% endif %}
                                <span class="listing-type-tag {{ car.listing_type }}">{{ car.listing_type|title }}</span>
                            </div>
                            <div class="card-content">
                                <h3>{{ car.year }} {{ car.make }} {{ car.model }}</h3>
                                <p>Price: {{ car.fixed_price or car.auction.current_price or car.rental_listing.price_per_day }} ETB</p>
                            </div>
                        </div>
                    </a>
                {% endfor %}
            </div>
        {% else %}
            <p>{{ dealer.username }} currently has no active listings.</p>
        {% endif %}
    </div>

    <div class="dashboard-section">
        <h2>Dealer Reviews</h2>
        {% if ratings %}
            <div class="review-list">
                {% for review in ratings %}
                    <div class="review-card">
                        <div class="review-header">
                            {% for i in range(5) %}
                                <span class="star {% if i < review.rating %}filled{% endif %}">★</span>
                            {% endfor %}
                            <span class="text-muted">{{ review.buyer.username }} on {{ review.timestamp.strftime('%b %d, %Y') }}</span>
                        </div>
                        {% if review.review_text %}
                            <p class="review-text">{{ review.review_text }}</p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No reviews yet for {{ dealer.username }}.</p>
        {% endif %}
    </div>
</div>
{% endblock %}